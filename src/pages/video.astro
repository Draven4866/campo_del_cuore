---
const baseHref = import.meta.env.BASE_URL.endsWith('/')
  ? import.meta.env.BASE_URL
  : import.meta.env.BASE_URL + '/';

const u = (p: string): string => baseHref + p.replace(/^\/+/, '');

// Link interni
const hrefHome = baseHref;
const hrefChi = u('chi-sono/');
const hrefVideo = u('video/');
const hrefCornice = u('cornice/');

// Background (gallery)
const bkgUrl = u('img/video-gallery_bkg.jpg');

// ===== SOLO FIX FONTS (come index.astro) =====
const spinFontUrl = u('fonts/Spin%20Cycle%20Regular.ttf');
const celtFontUrl = u('fonts/CELTG___.TTF');
const candFontUrl = u('fonts/candara.ttf');

const fontFaceCSS = `
@font-face{
  font-family:"SpinCycle";
  src:url("${spinFontUrl}") format("truetype");
  font-weight:400;
  font-style:normal;
  font-display:swap;
}
@font-face{
  font-family:"CelticGaramond";
  src:url("${celtFontUrl}") format("truetype");
  font-weight:400;
  font-style:normal;
  font-display:swap;
}
@font-face{
  font-family:"Candara";
  src:url("${candFontUrl}") format("truetype");
  font-weight:400;
  font-style:normal;
  font-display:swap;
}
`;
---

<!doctype html>
<html lang="it">
  <head>
    <meta charset="utf-8" />
    <base href={baseHref} />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Video — Il Campo del Cuore</title>

    <link rel="icon" type="image/png" href={u("favicon.png")} />

    <!-- Preload font -->
    <link rel="preload" href={spinFontUrl} as="font" type="font/ttf" crossorigin />
    <link rel="preload" href={celtFontUrl} as="font" type="font/ttf" crossorigin />
    <link rel="preload" href={candFontUrl} as="font" type="font/ttf" crossorigin />

    <!-- @font-face con URL assolute -->
    <style is:global set:html={fontFaceCSS}></style>
  </head>

    <!-- ✅ stessa logica: variabile CSS valorizzata INLINE -->
    <body style={`--bkg: url('${bkgUrl}');`}></body>
      <header class="topbar">
        <a class="brand" href={hrefHome}>Il Campo del Cuore</a>

        <nav id="siteNav" class="nav" aria-label="Menu">
          <a class="navItem" href={hrefChi}>Chi sono</a>
          <a class="navItem isActive" href={hrefVideo} aria-current="page">Galleria Video</a>
        </nav>

        <button
          class="navToggle"
          type="button"
          aria-expanded="false"
          aria-controls="siteNav"
          aria-label="Apri menu"
        >
          <span class="navBars" aria-hidden="true"></span>
        </button>
      </header>

    <main>
      <section class="pageHero" aria-label="Testata pagina">
        <div class="pageHeroInner">
          <h1>Galleria Video</h1>
          <p>Una voce guida per entrare nel ritmo del percorso.</p>
        </div>
      </section>

      <section class="paper" aria-label="Contenuto">
        <article class="paperInner">
          <h2 style="margin-top:0;">Video introduttivo</h2>

          <div class="videoWrap" aria-label="Video introduttivo">
            <iframe
              src="https://www.youtube-nocookie.com/embed/RUIxBlup5Y0"
              title="Video introduttivo — Il Campo del Cuore"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              allowfullscreen
            ></iframe>
          </div>

          <p class="note">
            Se preferisci leggere, trovi la cornice e la mappa introduttiva nella Home.
          </p>

          <div class="ctaRow" role="navigation" aria-label="Azioni">
            <a class="btn btnGhost" href={hrefHome} role="button">Torna alla Home</a>
            <a class="btn btnGhost" href={hrefCornice} role="button">Leggi la cornice</a>
          </div>
        </article>
      </section>
    </main>

    <footer class="footer">
      <small>© <span id="y"></span> Il Campo del Cuore</small>
    </footer>

    <script>
      const y = document.getElementById('y');
      if (y) y.textContent = String(new Date().getFullYear());
    </script>

    <script is:inline>
      (() => {
        const topbar = document.querySelector(".topbar");
        const btn = document.querySelector(".navToggle");
        const nav = document.getElementById("siteNav");

        if (!topbar || !btn || !nav) return;

        const open = () => {
          topbar.classList.add("navOpen");
          btn.setAttribute("aria-expanded", "true");
        };

        const close = () => {
          topbar.classList.remove("navOpen");
          btn.setAttribute("aria-expanded", "false");
        };

        const toggle = () => {
          const isOpen = topbar.classList.contains("navOpen");
          isOpen ? close() : open();
        };

        btn.addEventListener("click", (e) => {
          e.stopPropagation();
          toggle();
        });

        // chiudi cliccando fuori
        document.addEventListener("click", (e) => {
          if (!topbar.classList.contains("navOpen")) return;
          const t = e.target;
          if (!(t instanceof Node)) return;
          if (!topbar.contains(t)) close();
        });

        // chiudi con ESC
        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape") close();
        });

        // chiudi quando clicchi un link
        nav.querySelectorAll("a").forEach((a) => {
          a.addEventListener("click", () => close());
        });
      })();
    </script>

    <style>
      :root{
        --chakraGreen: rgba(150, 255, 190, 0.18);
        --ghostWhite: rgba(255,255,255,0.16);

        /* livello 2 (paperInner): trasparenza “vetro” */
        --paperBg: rgba(15,15,15,.30);
        --paperBorder: rgba(255,255,255,.22);
        --paperBlur: 14px;
      }

      /* ===== FONTS =====
         Nota: @font-face iniettati in <head> con URL assolute (vedi fontFaceCSS).
      */

      *{ box-sizing:border-box; }
      a{ color:inherit; text-decoration:none; }

      /* ===== BACKGROUND ===== */
      body{
        margin:0;
        color:#fff;
        font-family:"Candara", system-ui, -apple-system, Segoe UI, Roboto, Arial;
        line-height:1.5;

        background-color:#000; /* fallback */
        background-image: var(--bkg); /* ✅ prende da style inline sul body */
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        background-attachment: fixed;
      }

      /* TOPBAR */
      .topbar{
        position:sticky; top:0; z-index:60;
        display:flex; justify-content:space-between; align-items:center;
        padding:16px 22px;
        backdrop-filter:saturate(180%) blur(10px);
        background: rgba(210,235,255,.88);
        border-bottom:1px solid rgba(0,0,0,.06);
      }
      .brand{
        font-family:"SpinCycle","Candara",system-ui,sans-serif;
        font-weight:400;
        color:#0b0b0b;
      }
      .nav a{
        margin-left:14px;
        opacity:.85;
        font-family:"CelticGaramond","Candara",system-ui,serif;
        color:#0b0b0b;
      }
      .nav a:hover{ opacity:1; }
      .nav a[aria-current="page"]{
        opacity:1;
        text-decoration: underline;
        text-underline-offset: 6px;
      }

      /* ===== MOBILE HAMBURGER MENU (Campo del Cuore) ===== */
      .navToggle{
        display:none; /* desktop: nascosto */
        appearance:none;
        border: 1px solid rgba(0,0,0,0.15);
        background: rgba(0,0,0,0.06);
        border-radius: 12px;
        width: 46px;
        height: 46px;
        cursor:pointer;
        align-items:center;
        justify-content:center;
        flex: 0 0 auto;
      }

      /* icona 3 barre */
      .navBars{
        width: 22px;
        height: 2px;
        background: rgba(0,0,0,0.75);
        position: relative;
        display:block;
        border-radius: 2px;
      }
      .navBars::before,
      .navBars::after{
        content:"";
        position:absolute;
        left:0;
        width: 22px;
        height: 2px;
        background: rgba(0,0,0,0.75);
        border-radius: 2px;
      }
      .navBars::before{ top: -7px; }
      .navBars::after{ top: 7px; }

      @media (max-width: 900px){
        .navToggle{ display:flex; }

        /* dropdown */
        .nav{
          display:none; /* chiusa di default */
          position:absolute;
          top: calc(100% + 10px);
          right: 0;
          width: min(320px, 92vw);
          flex-direction: column;
          align-items: stretch;
          gap: 10px;
          padding: 12px;
          border-radius: 16px;
          background: rgba(255,255,255,0.96);
          border: 1px solid rgba(0,0,0,0.12);
          box-shadow: 0 18px 55px rgba(0,0,0,.16);
          backdrop-filter: blur(10px) saturate(180%);
          z-index: 60;
        }

        /* quando è aperto */
        .topbar.navOpen .nav{ display:flex; }

        /* touch-friendly */
        .nav a{
          display:block;
          padding: 10px 12px;
          border-radius: 12px;
        }
      }

      /* HERO */
      .pageHero{
        position:relative;
        padding: 64px 22px 28px;
        overflow:hidden;
      }
      .pageHero::before{
        content:"";
        position:absolute;
        inset:0;
        pointer-events:none;
        background:
          radial-gradient(70% 60% at 50% 10%, rgba(0,0,0,.10), rgba(0,0,0,.48)),
          linear-gradient(to bottom, rgba(0,0,0,.06), rgba(0,0,0,.56));
      }
      .pageHeroInner{
        position:relative;
        max-width: 900px;
        margin: 0 auto;
        text-align:center;
      }
      .pageHero h1{
        font-family:"SpinCycle","Candara",system-ui,sans-serif;
        font-weight:400;
        margin:0 0 10px;
        font-size: clamp(34px, 5vw, 58px);
        text-shadow: 0 2px 18px rgba(0,0,0,.55);
      }
      .pageHero p{
        font-family:"CelticGaramond","Candara",system-ui,serif;
        margin:0 auto;
        max-width: 70ch;
        opacity:.95;
        font-size: 18px;
        text-shadow: 0 2px 18px rgba(0,0,0,.55);
      }

      /* PAPER */
      .paper{ padding: 26px 22px 72px; }
      .paperInner{
        max-width: 900px;
        margin: 0 auto;
        padding: 22px 20px 26px;
        border-radius: 18px;

        background: var(--paperBg);
        backdrop-filter: blur(var(--paperBlur)) saturate(140%);
        border: 1px solid var(--paperBorder);
        box-shadow: 0 18px 55px rgba(0,0,0,.25);
      }

      .paperInner h2{
        font-family:"SpinCycle","Candara",system-ui,sans-serif;
        font-weight:400;
        margin: 18px 0 8px;
        font-size: 26px;
      }
      .paperInner p{
        margin: 0 0 14px;
        max-width: 75ch;
        font-size: 18px;
        color: rgba(255,255,255,.96);
        text-shadow: 0 2px 14px rgba(0,0,0,.45);
        text-align: justify;
        text-justify: inter-word;
        hyphens: auto;
      }
      .note{
        text-align:center;
        opacity:.92;
        max-width: 70ch;
        margin: 16px auto 0;
      }

      /* VIDEO centrato */
      .videoWrap{
        width: min(900px, 100%);
        margin: 12px auto 0;
        aspect-ratio: 16 / 9;
        border-radius: 16px;
        overflow:hidden;
        background:#000;
        box-shadow: 0 18px 55px rgba(0,0,0,.35);
        border: 1px solid rgba(255,255,255,.12);
      }
      .videoWrap iframe{
        width:100%;
        height:100%;
        border:0;
        display:block;
      }

      /* CTA */
      .ctaRow{
        margin-top: 18px;
        display:flex;
        gap:14px;
        flex-wrap:wrap;
        justify-content:center;
      }
      .btn{
        display:inline-flex;
        align-items:center;
        justify-content:center;
        padding: 12px 18px;
        border-radius: 999px;
        font-family: "CelticGaramond","Candara",system-ui,serif;
        font-weight: 600;
        line-height: 1;
        border: 1px solid rgba(255,255,255,.70);
        backdrop-filter: blur(8px);
        cursor:pointer;
        user-select:none;
        transition: transform .12s ease, filter .12s ease, background-color .12s ease;
      }
      .btn:focus-visible{
        outline: 2px solid rgba(255,255,255,.85);
        outline-offset: 3px;
      }

      .btnPrimary{
        background: var(--chakraGreen);
        color:#0b0b0b;
        border-color: rgba(0,0,0,.70);
      }
      .btnPrimary:hover{
        background: rgba(150,255,190,0.26);
        filter: brightness(1.03);
        transform: translateY(-1px);
      }

      .btnGhost{
        background: var(--ghostWhite);
        color:#fff;
        border-color: rgba(255,255,255,.70);
      }
      .btnGhost:hover{
        background: rgba(255,255,255,0.24);
        transform: translateY(-1px);
      }

      .footer{
        padding:30px 22px;
        border-top:1px solid rgba(255,255,255,.18);
        opacity:.85;
        text-shadow: 0 2px 18px rgba(0,0,0,.55);
      }

      @media (max-width: 900px){
        .paperInner{ padding: 20px 16px 24px; }
        .paperInner h2{ font-size:24px; }
        .paperInner p{ font-size:17px; }
      }
    </style>
  </body>
</html>
